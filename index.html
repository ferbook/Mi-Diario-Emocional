<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Registro de Emociones</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
    }

    h1 {
      font-size: 2em;
      margin-bottom: 20px;
    }

    .emotion-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 15px;
      gap: 10px;
    }

    .emotion-buttons button {
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }

    textarea {
      width: 90%;
      height: 100px;
      margin-bottom: 10px;
      font-size: 16px;
    }

    .btn-group {
      margin-bottom: 20px;
    }

    .btn-group button {
      margin: 5px;
      padding: 10px 15px;
      font-size: 16px;
    }

    #log {
      margin-top: 30px;
      text-align: left;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      border-top: 2px solid #ccc;
      padding-top: 20px;
    }

    .entry {
      background: #f9f9f9;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 8px;
    }

    .entry .timestamp {
      font-size: 0.8em;
      color: #666;
    }

    .entry .emotion {
      font-weight: bold;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>

  <h1>¿Cómo te sientes hoy?</h1>

  <div class="emotion-buttons" id="emotions">
    <button style="background-color: #4CAF50;" data-emotion="Feliz">Feliz</button>
    <button style="background-color: #2196F3;" data-emotion="Triste">Triste</button>
    <button style="background-color: #f44336;" data-emotion="Enojado">Enojado</button>
    <button style="background-color: #FF9800;" data-emotion="Paciente">Paciente</button>
    <button style="background-color: #9C27B0;" data-emotion="Ansioso">Ansioso</button>
    <button style="background-color: #795548;" data-emotion="Irritado">Irritado</button>
    <button style="background-color: #03A9F4;" data-emotion="Motivado">Motivado</button>
    <button style="background-color: #607D8B;" data-emotion="Cansado">Cansado</button>
    <button style="background-color: #8BC34A;" data-emotion="Relajado">Relajado</button>
    <button style="background-color: #E91E63;" data-emotion="Confundido">Confundido</button>
    <button style="background-color: #FF5722;" data-emotion="Esperanzado">Esperanzado</button>
    <button style="background-color: #3F51B5;" data-emotion="Nervioso">Nervioso</button>
  </div>

  <textarea id="comment" placeholder="Escribe tu comentario aquí..."></textarea>

  <div class="btn-group">
    <button onclick="guardarComentario()">Guardar Comentario</button>
    <button onclick="exportarPDF()">Exportar a PDF</button>
    <button onclick="verGrafica()">Ver Gráfica del Día</button>
  </div>

  <div id="log"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    let emocionSeleccionada = null;

    document.querySelectorAll("#emotions button").forEach(btn => {
      btn.addEventListener("click", () => {
        emocionSeleccionada = btn.dataset.emotion;
        alert("Emoción seleccionada: " + emocionSeleccionada);
      });
    });

    function guardarComentario() {
      const comentario = document.getElementById("comment").value.trim();
      if (!emocionSeleccionada || !comentario) {
        alert("Por favor selecciona una emoción y escribe un comentario.");
        return;
      }

      const ahora = new Date();
      const timestamp = ahora.toLocaleString();
      const entrada = { emocion: emocionSeleccionada, comentario, timestamp };

      let registros = JSON.parse(localStorage.getItem("emociones")) || [];
      registros.push(entrada);
      localStorage.setItem("emociones", JSON.stringify(registros));

      document.getElementById("comment").value = "";
      emocionSeleccionada = null;
      mostrarRegistros();
    }

    function mostrarRegistros() {
      const contenedor = document.getElementById("log");
      contenedor.innerHTML = "";
      const registros = JSON.parse(localStorage.getItem("emociones")) || [];

      registros.slice().reverse().forEach(entry => {
        const div = document.createElement("div");
        div.className = "entry";
        div.innerHTML = `
          <div class="emotion">${entry.emocion}</div>
          <div>${entry.comentario}</div>
          <div class="timestamp">${entry.timestamp}</div>
        `;
        contenedor.appendChild(div);
      });
    }

    function exportarPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const registros = JSON.parse(localStorage.getItem("emociones")) || [];

      doc.text("Registro de Emociones", 10, 10);
      let y = 20;
      registros.forEach(r => {
        doc.text(`[${r.timestamp}] ${r.emocion}: ${r.comentario}`, 10, y);
        y += 10;
        if (y > 270) {
          doc.addPage();
          y = 10;
        }
      });

      doc.save("registro_emociones.pdf");
    }

    function verGrafica() {
      const registros = JSON.parse(localStorage.getItem("emociones")) || [];
      const conteo = {};

      registros.forEach(r => {
        conteo[r.emocion] = (conteo[r.emocion] || 0) + 1;
      });

      const labels = Object.keys(conteo);
      const data = Object.values(conteo);

      const graficaVentana = window.open("", "_blank");
      graficaVentana.document.write(`
        <html><head><title>Gráfica de Emociones</title></head>
        <body><canvas id="grafica" width="400" height="400"></canvas>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
          const ctx = document.getElementById('grafica').getContext('2d');
          new Chart(ctx, {
            type: 'bar',
            data: {
              labels: ${JSON.stringify(labels)},
              datasets: [{
                label: 'Frecuencia de emociones',
                data: ${JSON.stringify(data)},
                backgroundColor: ${JSON.stringify(labels.map(() => 'rgba(75, 192, 192, 0.5)'))},
                borderColor: ${JSON.stringify(labels.map(() => 'rgba(75, 192, 192, 1)'))},
                borderWidth: 1
              }]
            },
            options: {
              scales: { y: { beginAtZero: true } }
            }
          });
        </script>
        </body></html>
      `);
    }

    // Mostrar los registros al cargar
    mostrarRegistros();
  </script>
</body>
</html>
